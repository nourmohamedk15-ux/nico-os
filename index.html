<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NICO OS V30 - Speaker ID</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/180/matrix-desktop.png">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&family=Poppins:wght@300;400;600&family=Orbitron:wght@500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #020617;
            --glass: rgba(15, 23, 42, 0.85);
            --accent: #38bdf8;
            --primary: #10b981;
            --text: #f1f5f9;
            --border: rgba(255, 255, 255, 0.1);
        }

        body { 
            margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); 
            color: var(--text); height: 100vh; overflow: hidden;
        }

        .bg-animate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; background: radial-gradient(circle at 50% 50%, #1e293b, #020617);
            overflow: hidden;
        }
        .blob {
            position: absolute; width: 350px; height: 350px;
            background: linear-gradient(135deg, rgba(56,189,248,0.2), rgba(16,185,129,0.15));
            filter: blur(80px); border-radius: 50%; animation: move 25s infinite alternate ease-in-out;
        }
        @keyframes move {
            0% { transform: translate(-20%, -20%); }
            100% { transform: translate(120%, 120%); }
        }

        .header {
            padding: 15px 20px; background: var(--glass); backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;
        }
        .stats-bar { font-size: 0.7rem; display: flex; gap: 12px; color: var(--accent); margin-top: 5px; font-weight: 600; }
        .stat-item { display: flex; align-items: center; gap: 5px; }
        .online-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--primary); box-shadow: 0 0 8px var(--primary); }
        .offline-dot { background: #ef4444; box-shadow: 0 0 8px #ef4444; }
        .time-box { font-family: 'Orbitron'; color: var(--primary); font-size: 1.2rem; letter-spacing: 1px; }

        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: 75px;
            background: var(--glass); backdrop-filter: blur(30px);
            border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 1000;
        }
        .nav-item { font-size: 1.6rem; cursor: pointer; opacity: 0.4; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .nav-item.active { opacity: 1; color: var(--accent); transform: translateY(-10px) scale(1.25); }

        .screen { display: none; height: calc(100vh - 160px); padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .screen.active { display: block; animation: slideUp 0.4s ease-out; }

        .card {
            background: var(--glass); border: 1px solid var(--border); border-radius: 24px;
            padding: 20px; margin-bottom: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            position: relative; backdrop-filter: blur(15px);
        }

        .input-group {
            background: rgba(15, 23, 42, 0.9); border: 1px solid var(--border);
            border-radius: 50px; padding: 8px 20px; display: flex; align-items: center; 
            backdrop-filter: blur(25px); box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        input { background: transparent; border: none; color: white; flex: 1; padding: 12px; outline: none; font-size: 16px; }

        .btn-small { background: var(--primary); border: none; color: white; padding: 8px 16px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; cursor: pointer; }
        .yt-link { display: block; text-align: center; background: #ef4444; color: white; padding: 14px; border-radius: 16px; text-decoration: none; font-weight: bold; margin-top: 15px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }
        .google-link { display: block; text-align: center; background: var(--accent); color: #020617; padding: 14px; border-radius: 16px; text-decoration: none; font-weight: bold; margin-top: 15px; }
        
        .del-btn { position: absolute; top: 12px; right: 18px; color: #ef4444; font-size: 1.4rem; cursor: pointer; opacity: 0.7; }
        .rtl { direction: rtl; font-family: 'Cairo'; text-align: right; color: var(--primary); font-size: 1.2rem; }

        #calc-box, #sticky-box, #timer-box {
            display: none; position: fixed; top: 12%; left: 50%; transform: translateX(-50%);
            width: 90%; z-index: 2000; background: rgba(15, 23, 42, 0.98); 
            border: 1px solid var(--accent); border-radius: 28px; padding: 25px; 
            box-shadow: 0 30px 60px rgba(0,0,0,0.9); backdrop-filter: blur(30px);
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="bg-animate">
        <div class="blob" style="top: -5%; left: -5%;"></div>
        <div class="blob" style="bottom: -5%; right: -5%; animation-delay: -7s; background: linear-gradient(135deg, #10b98122, #38bdf822);"></div>
    </div>

    <header class="header">
        <div>
            <div class="time-box" id="clock">00:00:00</div>
            <div class="stats-bar">
                <div class="stat-item"><div id="net-dot" class="online-dot"></div> <span id="net-text">Online</span></div>
                <div class="stat-item">‚ö° <span id="bat-text">--%</span></div>
                <div class="stat-item">üïå <span id="prayer-text" style="color:var(--primary)">Madinah...</span></div>
            </div>
        </div>
        <div style="display:flex; gap:18px; align-items: center;">
            <span onclick="toggleWidget('calc-box')" style="cursor:pointer; font-size:1.3rem;">üî¢</span>
            <span onclick="toggleWidget('timer-box')" style="cursor:pointer; font-size:1.3rem;">‚è±Ô∏è</span>
            <span onclick="toggleWidget('sticky-box')" style="cursor:pointer; font-size:1.3rem;">üìå</span>
            <button id="v-btn" onclick="unlockVoice()" style="border:none; background:none; font-size:1.3rem; cursor:pointer;">üîä</button>
        </div>
    </header>

    <div id="home" class="screen active">
        <div id="chat-feed" style="padding-bottom: 130px;"></div>
        <div style="position:fixed; bottom:90px; left:20px; right:20px; z-index:1001;">
            <div class="input-group">
                <span onclick="startVoice()" style="cursor:pointer; font-size:1.4rem; margin-right:10px;">üéôÔ∏è</span>
                <input type="text" id="user-in" placeholder="Say 'Hi Nico'..." onkeydown="if(event.key==='Enter') handleSend()">
                <span onclick="handleSend()" style="color:var(--primary); font-size:1.6rem; cursor:pointer;">‚ûî</span>
            </div>
        </div>
    </div>

    <div id="vault" class="screen">
        <h3 style="color:var(--accent); margin-bottom:15px; letter-spacing:1px;">üìÅ SYSTEM VAULT</h3>
        <div id="vault-content" class="card">Recent data will be cached here.</div>
        <h3 style="color:var(--primary); margin-top:35px; margin-bottom:15px; letter-spacing:1px;">üìú LOG HISTORY</h3>
        <div id="history-log"></div>
    </div>

    <div id="settings" class="screen">
        <h3 style="color:var(--primary)">‚öôÔ∏è CORE SETTINGS</h3>
        <div class="card">
            <p style="font-size:0.9rem;">Translation Direction:</p>
            <button class="btn-small" onclick="swapLang()" id="lang-ind">EN ‚Üí AR</button>
            <hr style="opacity:0.1; margin:20px 0;">
            <p style="font-size:0.8rem; opacity:0.6;">Maintenance:</p>
            <button class="btn-small" style="background:#ef4444" onclick="clearMemory()">FULL FACTORY RESET</button>
        </div>
    </div>

    <div id="calc-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><b>CALCULATOR</b> <span onclick="toggleWidget('calc-box')" style="cursor:pointer">‚úï</span></div>
        <input type="text" id="calc-screen" readonly style="width:100%; text-align:right; margin-bottom:15px; border:1px solid var(--border); background:rgba(0,0,0,0.4); font-family:'Orbitron'; padding:18px; font-size:1.3rem; border-radius:15px; color:var(--accent);">
        <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:12px;">
            <button class="btn-small" onclick="cIn('7')">7</button><button class="btn-small" onclick="cIn('8')">8</button><button class="btn-small" onclick="cIn('9')">9</button><button class="btn-small" onclick="cIn('/')">/</button>
            <button class="btn-small" onclick="cIn('4')">4</button><button class="btn-small" onclick="cIn('5')">5</button><button class="btn-small" onclick="cIn('6')">6</button><button class="btn-small" onclick="cIn('*')">*</button>
            <button class="btn-small" onclick="cIn('1')">1</button><button class="btn-small" onclick="cIn('2')">2</button><button class="btn-small" onclick="cIn('3')">3</button><button class="btn-small" onclick="cIn('-')">-</button>
            <button class="btn-small" onclick="cClr()" style="background:#475569">C</button><button class="btn-small" onclick="cIn('0')">0</button><button class="btn-small" onclick="cEq()">=</button><button class="btn-small" onclick="cIn('+')">+</button>
        </div>
    </div>

    <div id="timer-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><b>STOPWATCH / TIMER</b> <span onclick="toggleWidget('timer-box')" style="cursor:pointer">‚úï</span></div>
        <div style="text-align:center;">
            <div id="sw-display" style="font-family:'Orbitron'; font-size:2.5rem; color:var(--accent); margin-bottom:20px;">00:00:00</div>
            <div style="display:flex; gap:10px; justify-content: center; margin-bottom:20px;">
                <button class="btn-small" onclick="startSW()">START</button>
                <button class="btn-small" style="background:#475569" onclick="stopSW()">STOP</button>
                <button class="btn-small" style="background:#ef4444" onclick="resetSW()">RESET</button>
            </div>
            <hr style="opacity:0.1; margin:20px 0;">
            <div style="display:flex; gap:5px; align-items:center; justify-content:center;">
                <input type="number" id="t-min" placeholder="Min" style="width:60px; text-align:center; background:rgba(255,255,255,0.1); border-radius:10px; padding:5px;">
                <button class="btn-small" onclick="startTimer()">START TIMER</button>
            </div>
        </div>
    </div>

    <div id="sticky-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px;"><b>SECURE NOTES</b> <span onclick="toggleWidget('sticky-box')" style="cursor:pointer">‚úï</span></div>
        <textarea id="noteArea" style="width:100%; height:320px; background:rgba(0,0,0,0.4); color:white; border:none; border-radius:20px; padding:20px; font-family:inherit; outline:none; resize:none; font-size:1rem;" placeholder="Start typing..."></textarea>
    </div>

    <nav class="nav-bar">
        <span class="nav-item active" onclick="showScreen('home', this)">ü§ñ</span>
        <span class="nav-item" onclick="showScreen('vault', this)">üìÅ</span>
        <span class="nav-item" onclick="showScreen('settings', this)">‚öôÔ∏è</span>
    </nav>

<script>
    let STATE = {
        history: JSON.parse(localStorage.getItem('n_hist')) || [],
        chat: JSON.parse(localStorage.getItem('n_chat')) || [],
        vault: localStorage.getItem('n_vault') || "Search results will appear here.",
        notes: localStorage.getItem('n_notes') || "",
        langPair: 'en|ar',
        sessionUser: localStorage.getItem('n_user') || "Nour" 
    };

    let voiceEnabled = false;
    function unlockVoice() {
        voiceEnabled = true;
        const greetingText = `Vocal interface active. Welcome, ${STATE.sessionUser}.`;
        const u = new SpeechSynthesisUtterance(greetingText);
        window.speechSynthesis.speak(u);
        document.getElementById('v-btn').innerHTML = '‚úÖ';
        setTimeout(() => document.getElementById('v-btn').style.opacity = "0.4", 2000);
    }

    function speak(t, l = 'en-US') {
        if(!voiceEnabled) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(t); u.lang = l; u.rate = 0.9;
        window.speechSynthesis.speak(u);
    }

    let currentPrayerTime = "Checking...";
    async function getPrayers() {
        try {
            const r = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Madinah&country=Saudi+Arabia&method=4');
            const d = await r.json();
            const t = d.data.timings;
            currentPrayerTime = t.Dhuhr;
            document.getElementById('prayer-text').innerText = `Dhuhr: ${t.Dhuhr}`;
        } catch(e) { document.getElementById('prayer-text').innerText = "Madinah"; }
    }
    getPrayers();
    setInterval(getPrayers, 3600000);

    function updateStats() {
        if (navigator.getBattery) {
            navigator.getBattery().then(bat => {
                const updateBat = () => {
                    document.getElementById('bat-text').innerText = `${Math.round(bat.level * 100)}% ${bat.charging ? 'üîå' : ''}`;
                };
                updateBat();
                bat.onlevelchange = updateBat;
                bat.onchargingchange = updateBat;
            });
        }
        const dot = document.getElementById('net-dot');
        const txt = document.getElementById('net-text');
        if (navigator.onLine) {
            dot.className = "online-dot"; txt.innerText = "Online";
        } else {
            dot.className = "online-dot offline-dot"; txt.innerText = "Offline";
        }
    }
    window.addEventListener('online', updateStats);
    window.addEventListener('offline', updateStats);
    updateStats();

    window.onload = () => {
        renderChat(); renderLog();
        document.getElementById('vault-content').innerHTML = STATE.vault;
        document.getElementById('noteArea').value = STATE.notes;
    };

    document.getElementById('noteArea').oninput = (e) => localStorage.setItem('n_notes', e.target.value);

    function showScreen(id, el) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    function toggleWidget(id) {
        const w = document.getElementById(id);
        w.style.display = (w.style.display === 'block') ? 'none' : 'block';
    }

    async function handleSend() {
        const input = document.getElementById('user-in');
        const val = input.value.trim(); if(!val) return;
        addMsg('user', val);
        input.value = "";
        const cmd = val.toLowerCase();

        if (cmd.startsWith("i am ") || cmd.startsWith("my name is ") || cmd.startsWith("call me ")) {
            const words = cmd.split(" ");
            const newName = words[words.length - 1];
            const capitalizedName = newName.charAt(0).toUpperCase() + newName.slice(1);
            STATE.sessionUser = capitalizedName;
            localStorage.setItem('n_user', capitalizedName);
            let r = (capitalizedName === "Nour") ? "Identity restored. Welcome back, Nour." : `Understood. Hello, ${capitalizedName}.`;
            addMsg('nico', r); speak(r);
            return;
        }

        if (cmd.includes("hi") || cmd.includes("hello") || cmd.includes("hey nico")) {
            const r = `System online. Hello ${STATE.sessionUser}. What's on your mind?`;
            addMsg('nico', r); speak(r);
            return;
        }

        // --- NEW APP COMMANDS ---
        if(cmd.includes("open youtube")) {
            addMsg('nico', "Launching YouTube...");
            speak("Opening YouTube");
            window.open("https://www.youtube.com", "_blank");
            return;
        }
        else if(cmd.includes("open gmail") || cmd.includes("open email")) {
            addMsg('nico', "Accessing Mail Server...");
            speak("Opening Gmail");
            window.open("https://mail.google.com", "_blank");
            return;
        }
        else if(cmd.includes("open zoom")) {
            addMsg('nico', "Starting Zoom...");
            speak("Opening Zoom");
            window.open("https://zoom.us", "_blank");
            return;
        }

        // --- YARGI QUOTES ENGINE ---
        else if(cmd.includes("yargi quote") || cmd.includes("philosophize")) {
            const yargiQuotes = [
                "‚ÄúAn item you try to hide, becomes a burden you have to carry.‚Äù ‚Äî Miguel de Cervantes",
                "‚ÄúA water source cannot be both sweet and bitter.‚Äù ‚Äî Heraclitus",
                "‚ÄúNo one is as innocent as they think, nor as guilty as others say.‚Äù",
                "‚ÄúWhatever you hide, stays with you; whatever you share, belongs to everyone.‚Äù",
                "‚ÄúThe truth is like surgery. It hurts, but it heals.‚Äù",
                "‚ÄúEvery choice is a renunciation.‚Äù ‚Äî Honor√© de Balzac",
                "‚ÄúJustice is the constant and perpetual will to render to each his due.‚Äù ‚Äî Ulpian"
            ];
            const randomQuote = yargiQuotes[Math.floor(Math.random() * yargiQuotes.length)];
            addMsg('nico', `üìú <i style="color:var(--accent)">${randomQuote}</i>`);
            speak(randomQuote);
            return;
        }

        if(cmd.startsWith("translate ")) {
            const q = val.substring(10);
            addMsg('nico', "Analyzing linguistics...");
            try {
                const r = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(q)}&langpair=${STATE.langPair}&de=nour@nico-os.com`);
                const d = await r.json();
                let res = d.responseData.translatedText;
                res = res.replace("ÿ£ŸÜÿß ŸäŸÉŸàŸÜ", "ÿ£ŸÜÿß").replace("ŸáŸà ŸäŸÉŸàŸÜ", "ŸáŸà").replace("ŸáŸä ÿ™ŸÉŸàŸÜ", "ŸáŸä"); 
                const isAR = STATE.langPair === 'en|ar';
                addMsg('nico', `<div class="${isAR?'rtl':''}">${res}</div>`);
                saveToLog(q, res, isAR);
                speak(res, isAR ? 'ar-SA' : 'en-US');
            } catch(e) { addMsg('nico', "Translation engine timeout."); }
            return;
        } 

        if (cmd.includes("how are you")) {
            const r = `I'm functioning perfectly, ${STATE.sessionUser}!`;
            addMsg('nico', r); speak(r);
        }
        else if (cmd.includes("fine") || cmd.includes("alhumdulillah") || cmd.includes("good")) {
            const r = "Alhumdulillah, I am glad to hear that.";
            addMsg('nico', r); speak(r);
        }
        else if(cmd.includes("open whatsapp")) {
            addMsg('nico', "Opening WhatsApp...");
            speak("Opening WhatsApp");
            window.location.href = "whatsapp://send";
            setTimeout(() => { if(document.hasFocus()) window.open("https://web.whatsapp.com/", "_blank"); }, 1000);
        }
        else if(cmd.includes("briefing") || cmd.includes("start my day")) {
            const time = new Date().toLocaleTimeString('en-GB', {hour:'2-digit', minute:'2-digit'});
            const briefingText = `Good morning ${STATE.sessionUser}. It is ${time}. Dhuhr in Madinah is at ${currentPrayerTime}. System ready.`;
            addMsg('nico', briefingText); speak(briefingText);
        }
        else if(cmd.startsWith("video ")) {
            const q = val.substring(6);
            const url = `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`;
            addMsg('nico', `Search for <b>${q}</b> ready.<br><a href="${url}" target="_blank" class="yt-link">WATCH ON YOUTUBE ‚ûî</a>`);
        }
        else if(cmd.startsWith("search ")) {
            const q = val.substring(7);
            addMsg('nico', `Searching Vault...`);
            try {
                const r = await fetch(`https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts&exintro&explaintext&titles=${encodeURIComponent(q)}`);
                const d = await r.json();
                const id = Object.keys(d.query.pages)[0];
                let content = (id === "-1") ? `<div style="text-align:center; padding:10px;">No Wiki entry. <a href="https://www.google.com/search?q=${encodeURIComponent(q)}" target="_blank" class="google-link">GOOGLE ‚ûî</a></div>` : `<b>${d.query.pages[id].title}</b><hr style="opacity:0.2;">${d.query.pages[id].extract}`;
                STATE.vault = content; localStorage.setItem('n_vault', content);
                document.getElementById('vault-content').innerHTML = content;
                showScreen('vault', document.querySelectorAll('.nav-item')[1]);
            } catch(e) { addMsg('nico', "Error."); }
        }
    }

    let swInterval, swSec = 0;
    function startSW() {
        clearInterval(swInterval);
        swInterval = setInterval(() => {
            swSec++;
            let h = Math.floor(swSec/3600).toString().padStart(2,'0');
            let m = Math.floor((swSec%3600)/60).toString().padStart(2,'0');
            let s = (swSec%60).toString().padStart(2,'0');
            document.getElementById('sw-display').innerText = `${h}:${m}:${s}`;
        }, 1000);
    }
    function stopSW() { clearInterval(swInterval); }
    function resetSW() { stopSW(); swSec = 0; document.getElementById('sw-display').innerText = "00:00:00"; }
    
    function startTimer() {
        let mins = document.getElementById('t-min').value;
        if(!mins) return;
        let target = mins * 60;
        document.getElementById('timer-box').style.display = 'none';
        addMsg('nico', `Timer set for ${mins} minutes.`);
        setTimeout(() => {
            speak("Time is up!");
            alert("Timer Finished!");
        }, target * 1000);
    }

    function addMsg(who, txt) {
        STATE.chat.push({who, txt});
        if(STATE.chat.length > 20) STATE.chat.shift();
        localStorage.setItem('n_chat', JSON.stringify(STATE.chat));
        renderChat();
    }
    function renderChat() {
        document.getElementById('chat-feed').innerHTML = STATE.chat.map(c => `<div class="card" style="padding:15px; border-left:5px solid ${c.who==='user'?'var(--accent)':'var(--primary)'}"><small style="color:${c.who==='user'?'var(--accent)':'var(--primary)'}; font-weight:bold;">${c.who.toUpperCase()}</small><br>${c.txt}</div>`).join('');
        document.getElementById('home').scrollTop = 9999;
    }
    function saveToLog(o, t, isAR) { STATE.history.unshift({o, t, isAR, id: Date.now()}); localStorage.setItem('n_hist', JSON.stringify(STATE.history)); renderLog(); }
    function deleteLog(id) { STATE.history = STATE.history.filter(i => i.id !== id); localStorage.setItem('n_hist', JSON.stringify(STATE.history)); renderLog(); }
    function renderLog() { document.getElementById('history-log').innerHTML = STATE.history.map(h => `<div class="card" style="font-size:0.9rem;"><span class="del-btn" onclick="deleteLog(${h.id})">√ó</span><b style="color:var(--accent)">${h.o}</b><br><span class="${h.isAR?'rtl':''}">${h.t}</span></div>`).join(''); }
    function swapLang() { STATE.langPair = (STATE.langPair === 'en|ar') ? 'ar|en' : 'en|ar'; document.getElementById('lang-ind').innerText = (STATE.langPair === 'en|ar') ? 'EN ‚Üí AR' : 'AR ‚Üí EN'; }
    function cIn(v) { document.getElementById('calc-screen').value += v; }
    function cClr() { document.getElementById('calc-screen').value = ''; }
    function cEq() { try { document.getElementById('calc-screen').value = eval(document.getElementById('calc-screen').value); } catch(e) { alert('Error'); } }
    function clearMemory() { if(confirm("Erase data?")) { localStorage.clear(); location.reload(); } }
    
    function startVoice() {
        const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
        if(!Speech) return alert("Browser not supported.");
        const rec = new Speech();
        rec.start();
        rec.onresult = (e) => { 
            document.getElementById('user-in').value = e.results[0][0].transcript; 
            handleSend(); 
        };
    }
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB', { timeZone: "Asia/Riyadh", hour12: false }); }, 1000);
</script>
</body>
</html>
