<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NICO OS Pro</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/180/matrix-desktop.png">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&family=Poppins:wght@300;400;600&family=Orbitron:wght@500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #020617;
            --glass: rgba(15, 23, 42, 0.8);
            --accent: #38bdf8;
            --primary: #10b981;
            --text: #f1f5f9;
            --border: rgba(255, 255, 255, 0.1);
        }

        body { 
            margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); 
            color: var(--text); height: 100vh; overflow: hidden;
            background-image: radial-gradient(circle at 50% -20%, #1e293b, #020617);
        }

        /* Top Header */
        .header {
            padding: 10px 20px; background: var(--glass); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;
        }

        .time-box { font-family: 'Orbitron'; color: var(--primary); font-size: 1rem; }

        /* Bottom Nav */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: 65px;
            background: var(--glass); backdrop-filter: blur(20px);
            border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 1000;
        }

        .nav-item { font-size: 1.4rem; cursor: pointer; opacity: 0.6; transition: 0.3s; }
        .nav-item.active { opacity: 1; color: var(--accent); transform: translateY(-5px); }

        /* Screens */
        .screen { display: none; height: calc(100vh - 130px); padding: 15px; overflow-y: auto; }
        .screen.active { display: block; animation: fadeIn 0.3s; }

        .card {
            background: var(--glass); border: 1px solid var(--border); border-radius: 20px;
            padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        /* Utility Widgets (Floating) */
        #calc-box, #sticky-box {
            display: none; position: fixed; top: 15%; left: 50%; transform: translateX(-50%);
            width: 85%; z-index: 2000; background: #1e293b; border: 1px solid var(--accent);
            border-radius: 20px; padding: 15px; box-shadow: 0 0 40px rgba(0,0,0,0.8);
        }

        /* Inputs */
        .input-group {
            background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            border-radius: 50px; padding: 5px 15px; display: flex; align-items: center;
        }
        input { background: transparent; border: none; color: white; flex: 1; padding: 10px; outline: none; }

        .btn-small { background: var(--primary); border: none; color: white; padding: 5px 12px; border-radius: 10px; font-size: 0.7rem; }
        .rtl { direction: rtl; font-family: 'Cairo'; text-align: right; color: var(--primary); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <div class="time-box" id="clock">00:00:00</div>
            <div style="font-size: 0.5rem; color: var(--accent);">NICO V24 PRO</div>
        </div>
        <div style="display:flex; gap:15px;">
            <span onclick="toggleWidget('calc-box')">üî¢</span>
            <span onclick="toggleWidget('sticky-box')">üìå</span>
            <button id="v-btn" onclick="unlockVoice()" style="border:none; background:none; font-size:1.2rem;">üîä</button>
        </div>
    </div>

    <div id="home" class="screen active">
        <div id="chat-feed" style="margin-bottom:80px;"></div>
        <div style="position:fixed; bottom:75px; left:10px; right:10px;">
            <div class="input-group">
                <span onclick="startVoice()">üéôÔ∏è</span>
                <input type="text" id="user-in" placeholder="Command (translate / search)..." onkeydown="if(event.key==='Enter') handleSend()">
                <span onclick="handleSend()" style="color:var(--primary)">‚ûî</span>
            </div>
        </div>
    </div>

    <div id="vault" class="screen">
        <h3 style="color:var(--accent)">üíé VAULT</h3>
        <div id="vault-content" class="card">No data searched yet.</div>
        <h4 style="font-size:0.8rem;">RECENT LOGS</h4>
        <div id="history-log"></div>
    </div>

    <div id="settings" class="screen">
        <h3 style="color:var(--primary)">‚öôÔ∏è SYSTEM</h3>
        <div class="card">
            <p>Language Direction:</p>
            <button class="btn-small" onclick="swapLang()" id="lang-ind">EN ‚Üí AR</button>
            <hr style="opacity:0.1">
            <button class="btn-small" style="background:#ef4444" onclick="clearMemory()">FACTORY RESET</button>
        </div>
    </div>

    <div id="calc-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><b>Calculator</b> <span onclick="toggleWidget('calc-box')">‚úï</span></div>
        <input type="text" id="calc-screen" readonly style="width:100%; text-align:right; margin-bottom:10px; border:1px solid var(--border)">
        <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:8px;">
            <button class="btn-small" onclick="cIn('7')">7</button><button class="btn-small" onclick="cIn('8')">8</button><button class="btn-small" onclick="cIn('9')">9</button><button class="btn-small" onclick="cIn('/')">/</button>
            <button class="btn-small" onclick="cIn('4')">4</button><button class="btn-small" onclick="cIn('5')">5</button><button class="btn-small" onclick="cIn('6')">6</button><button class="btn-small" onclick="cIn('*')">*</button>
            <button class="btn-small" onclick="cIn('1')">1</button><button class="btn-small" onclick="cIn('2')">2</button><button class="btn-small" onclick="cIn('3')">3</button><button class="btn-small" onclick="cIn('-')">-</button>
            <button class="btn-small" onclick="cClr()">C</button><button class="btn-small" onclick="cIn('0')">0</button><button class="btn-small" onclick="cEq()">=</button><button class="btn-small" onclick="cIn('+')">+</button>
        </div>
    </div>

    <div id="sticky-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><b>Quick Notes</b> <span onclick="toggleWidget('sticky-box')">‚úï</span></div>
        <textarea id="noteArea" style="width:100%; height:200px; background:rgba(0,0,0,0.2); color:white; border:none; border-radius:10px; padding:10px;" placeholder="Type here..."></textarea>
    </div>

    <div class="nav-bar">
        <span class="nav-item active" onclick="showScreen('home', this)">ü§ñ</span>
        <span class="nav-item" onclick="showScreen('vault', this)">üìÅ</span>
        <span class="nav-item" onclick="showScreen('settings', this)">‚öôÔ∏è</span>
    </div>

<script>
    let STATE = {
        history: JSON.parse(localStorage.getItem('n_hist')) || [],
        chat: JSON.parse(localStorage.getItem('n_chat')) || [],
        vault: localStorage.getItem('n_vault') || "Ready.",
        notes: localStorage.getItem('n_notes') || "",
        langPair: 'en|ar'
    };

    let voiceEnabled = false;
    function unlockVoice() {
        voiceEnabled = true;
        const u = new SpeechSynthesisUtterance("System online");
        window.speechSynthesis.speak(u);
        document.getElementById('v-btn').innerHTML = '‚úÖ';
    }

    function speak(t, l) {
        if(!voiceEnabled) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(t); u.lang = l;
        window.speechSynthesis.speak(u);
    }

    window.onload = () => {
        renderChat(); renderLog();
        document.getElementById('vault-content').innerHTML = STATE.vault;
        document.getElementById('noteArea').value = STATE.notes;
    };

    // Save Notes on type
    document.getElementById('noteArea').oninput = (e) => {
        localStorage.setItem('n_notes', e.target.value);
    };

    function showScreen(id, el) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    function toggleWidget(id) {
        const w = document.getElementById(id);
        w.style.display = w.style.display === 'block' ? 'none' : 'block';
    }

    async function handleSend() {
        const input = document.getElementById('user-in');
        const val = input.value.trim(); if(!val) return;
        addMsg('user', val);
        input.value = "";

        const cmd = val.toLowerCase();
        if(cmd.startsWith("translate ")) {
            const q = val.substring(10);
            const r = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(q)}&langpair=${STATE.langPair}`);
            const d = await r.json();
            const res = d.responseData.translatedText;
            const isAR = STATE.langPair === 'en|ar';
            addMsg('nico', `<div class="${isAR?'rtl':''}">${res}</div>`);
            saveToLog(q, res, isAR);
            speak(res, isAR ? 'ar-SA' : 'en-US');
        } else if(cmd.startsWith("search ")) {
            const q = val.substring(7);
            const r = await fetch(`https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts&exintro&explaintext&titles=${encodeURIComponent(q)}`);
            const d = await r.json();
            const id = Object.keys(d.query.pages)[0];
            let content = id === "-1" ? `No results for ${q}` : `<b>${d.query.pages[id].title}</b><hr>${d.query.pages[id].extract}`;
            STATE.vault = content; localStorage.setItem('n_vault', content);
            document.getElementById('vault-content').innerHTML = content;
            showScreen('vault', document.querySelectorAll('.nav-item')[1]);
        }
    }

    function addMsg(who, txt) {
        STATE.chat.push({who, txt});
        if(STATE.chat.length > 15) STATE.chat.shift();
        localStorage.setItem('n_chat', JSON.stringify(STATE.chat));
        renderChat();
    }

    function renderChat() {
        document.getElementById('chat-feed').innerHTML = STATE.chat.map(c => `
            <div class="card" style="padding:10px; margin-bottom:10px;">
                <b style="font-size:0.7rem; color:var(--accent)">${c.who.toUpperCase()}</b><br>${c.txt}
            </div>`).join('');
        document.getElementById('home').scrollTop = 9999;
    }

    function saveToLog(o, t, isAR) {
        STATE.history.unshift({o, t, isAR, id: Date.now()});
        localStorage.setItem('n_hist', JSON.stringify(STATE.history));
        renderLog();
    }

    function renderLog() {
        document.getElementById('history-log').innerHTML = STATE.history.map(h => `
            <div class="card" style="font-size:0.8rem; margin-bottom:5px;">
                <b>${h.o}</b><br><span class="${h.isAR?'rtl':''}">${h.t}</span>
            </div>`).join('');
    }

    function swapLang() { 
        STATE.langPair = STATE.langPair === 'en|ar' ? 'ar|en' : 'en|ar';
        document.getElementById('lang-ind').innerText = STATE.langPair === 'en|ar' ? 'EN ‚Üí AR' : 'AR ‚Üí EN';
    }

    // Calc Logic
    function cIn(v) { document.getElementById('calc-screen').value += v; }
    function cClr() { document.getElementById('calc-screen').value = ''; }
    function cEq() { try { document.getElementById('calc-screen').value = eval(document.getElementById('calc-screen').value); } catch(e) { alert('Error'); } }

    function clearMemory() { if(confirm("Clear all data?")) { localStorage.clear(); location.reload(); } }
    function startVoice() {
        const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        rec.start();
        rec.onresult = (e) => { document.getElementById('user-in').value = e.results[0][0].transcript; handleSend(); };
    }

    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB', { timeZone: "Asia/Riyadh", hour12: false });
    }, 1000);
</script>
</body>
</html>
